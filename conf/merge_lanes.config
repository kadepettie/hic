/*
 * -------------------------------------------------
 *  nf-core/hic Nextflow config file
 * -------------------------------------------------
 * Default config options for all environments.
 */

// Global default params, used in configs
params {
  // Inputs / outputs
  input = "/cashew/users/kade/hichip/1000G/H3K27ac/fastqs/round**/*" // null
  input_paths = null
  merge_lanes_rounds = true
  merge_reps = true
  save_merge = true
  outdir = './results'
  genome = 'GRCh37' // specify igenomes genome defined in conf/igenomes.config
  input_paths = false
  chromosome_size = false // false uses igenomes
  restriction_fragments = false // false uses igenomes
  save_reference = true

  // Mapping
  split_fastq = true
  fastq_chunks_size = 20000000
  save_interaction_bam = true
  save_aligned_intermediates = false
  bwt2_opts_end2end = '--very-sensitive -L 30 --score-min L,-0.6,-0.2 --end-to-end --reorder'
  bwt2_opts_trimmed = '--very-sensitive -L 20 --score-min L,-0.6,-0.2 --end-to-end --reorder'
  keep_dups = false
  keep_multi = false
  min_mapq = 5 // 10


  // Digestion Hi-C
  digestion = 'mboi' // false
  digest {
    'hindiii'{
       restriction_site='A^AGCTT'
       ligation_site='AAGCTAGCTT'
    }
    'mboi' {
       restriction_site='^GATC'
       ligation_site='GATCGATC'
    }
    'dpnii' {
       restriction_site='^GATC'
       ligation_site='GATCGATC'
    }
    'arima' {
       restriction_site='^GATC,G^ANT'
       ligation_site='GATCGATC,GATCGANT,GANTGATC,GANTGANT'
    }
  }
  min_restriction_fragment_size = 0
  max_restriction_fragment_size = 0
  min_insert_size = 0
  max_insert_size = 0
  save_nonvalid_pairs = false

  // Dnase Hi-C
  dnase = false
  min_cis_dist = 0

  // Contact maps
  bin_size = '1000000,500000,5000' // '1000000'
  res_zoomify = '5000'
  hicpro_maps = true // false
  ice_max_iter = 100
  ice_filter_low_count_perc = 0.02
  ice_filter_high_count_perc =  0
  ice_eps = 0.1

  // Downstream Analysis
  res_dist_decay = '250000'
  tads_caller = 'insulation'
  res_tads = '40000'
  res_compartments = '250000'

  // Workflow
  skip_maps = false
  skip_balancing = false
  skip_mcool = false
  skip_dist_decay = false
  skip_compartments = false
  skip_tads = false
  skip_multiqc = false

  // Boilerplate options
  publish_dir_mode = 'rellink'
  multiqc_config = false
  email = 'kpettie@stanford.edu'// false
  email_on_fail = 'kpettie@stanford.edu' // false
  max_multiqc_email_size = 25.MB
  plaintext_email = false
  monochrome_logs = false
  help = false
  igenomes_base = 's3://ngi-igenomes/igenomes'
  tracedir = "${params.outdir}/pipeline_info"
  igenomes_ignore = false

  //Config
  custom_config_version = 'master'
  custom_config_base = "https://raw.githubusercontent.com/nf-core/configs/${params.custom_config_version}"
  hostnames = false
  config_profile_name = 'merge_lanes_fraser'
  config_profile_description = false
  config_profile_contact = false
  config_profile_url = false
  validate_params = true
  show_hidden_params = false
  schema_ignore_params = 'genomes,digest,input_paths'

  // Defaults only, expecting to be overwritten
  max_memory = 128.GB // 24.GB
  max_cpus = 32 // 8
  max_time = 240.h
}

process{
  maxForks = 200
  stageInMode = 'rellink'
}

executor{
  name = 'slurm'
  submitRateLimit = '1 sec'
  queueSize = 500
}

notification{
  enabled = true
  to = 'kpettie@stanford.edu'
}

def trace_timestamp = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss')
timeline {
  enabled = true
  file = "${params.tracedir}/execution_timeline_${trace_timestamp}.html"
}
report {
  enabled = true
  file = "${params.tracedir}/execution_report_${trace_timestamp}.html"
}
trace {
  enabled = true
  file = "${params.tracedir}/execution_trace_${trace_timestamp}.txt"
}
dag {
  enabled = true
  file = "${params.tracedir}/pipeline_dag_${trace_timestamp}.svg"
}
